<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Mon 1er jeu Phaser</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>
    <script type="text/javascript">


    class Game extends Phaser.Scene{
        
        constructor(){
            super('game')
        }

        preload(){
            this.load.image('tiles', 'dungeon_tiles.png');
            this.load.tilemapTiledJSON('dungeon', 'dungeon-01.json');

            this.load.spritesheet('player', 'character.png',
                { frameWidth: 16, frameHeight: 32 });

            //this.load.atlas('player', 'character.png', 'character.json')
        
            this.cursors = this.input.keyboard.createCursorKeys();


        }

        create(){

            const map = this.make.tilemap({key : 'dungeon'})

            const tileset = map.addTilesetImage('dungeon', 'tiles')

            map.createStaticLayer('Ground', tileset);
            const wallsLayer = map.createStaticLayer('Walls', tileset);

            wallsLayer.setCollisionByProperty({collides : true})

            const DebugGraphics = this.add.graphics().setAlpha(0.7);
            wallsLayer.renderDebug(DebugGraphics, {
                tileColor: null,
                collidingTileColor : new Phaser.Display.Color(243, 234, 48, 255),
                faceColor : new Phaser.Display.Color(40, 39, 37, 255)
            })

            this.player = this.physics.add.sprite(50, 50, 'player');           

            /*this.anims.create({
                    key: 'left',
                    frames: this.anims.generateFrameNumbers('player', { start: 46, end: 49 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'iddle',
                    frames: [{ key: 'perso', frame: 4 }],
                    frameRate: 20
                });

                this.anims.create({
                    key: 'right',
                    frames: this.anims.generateFrameNumbers('player', { start: 16, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });
        
                this.anims.create({
                    key: 'up',
                    frames: this.anims.generateFrameNumbers('player', { start: 31, end: 34 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'down',
                    frames: this.anims.generateFrameNumbers('player', { start: 1, end: 4 }),
                    frameRate: 10,
                    repeat: -1
                });*/
        
        }

        update(){
            
            const speed = 175;

                this.player.body.setVelocity(0);

                if (this.cursors.left.isDown) { //si la touche gauche est appuyée
                    this.player.setVelocityX(-speed); //alors vitesse négative en X
                    //this.player.anims.play('left', true); //et animation => gauche
                }

                else if (this.cursors.right.isDown) { //sinon si la touche droite est appuyée
                    this.player.setVelocityX(speed); //alors vitesse positive en X
                    //this.player.anims.play('right', true); //et animation => droite
                }


                if (this.cursors.down.isDown) {
                this.player.setVelocityY(speed);
                }

                else if (this.cursors.up.isDown){
                    this.player.setVelocityY(-speed);
                }

                // Normalize and scale the velocity so that player can't move faster along a diagonal
                this.player.body.velocity.normalize().scale(speed);


                // ANIMATIONS

                /*if (this.cursors.left.isDown) { //si la touche gauche est appuyée
                    this.player.anims.play('left', true); //et animation => gauche
                }

                else if (this.cursors.right.isDown) { //sinon si la touche droite est appuyée
                    this.player.anims.play('right', true); //et animation => droite
                }
                
                else if (this.cursors.up.isDown){
                    this.player.anims.play('up', true);
                    //animation vers le haut
                }

                else if (this.cursors.down.isDown){
                    this.player.anims.play('down', true);
                    //animation vers le bas
                }

                else {
                    this.player.anims.play('iddle'); //animation fait face caméra
                }*/

        
        }

    }

    const config = {
                type: Phaser.AUTO, // Which renderer to use
                width: 400, // Canvas width in pixels
                height: 250, // Canvas height in pixels

                physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: true
                }
                },

                scene: [Game],
                scale : {
                    zoom : 2
                }
            }
            
            new Phaser.Game(config);

    </script>
</body>

</html>